<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Ventas</title>
    <link rel="stylesheet" href="../../static/css/styles.css">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>
<body>

    {% from "macros.html" import macros %}
    
    {{ macros() }}

    <main class="p-6">
        <h1 class="text-center text-2xl font-bold mb-6">Dashboard</h1>
        <div id="flowbite-form-container"></div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const container = document.getElementById('flowbite-form-container');
            const shadow = container.attachShadow({ mode: 'open' });
            
            // Contenido del shadow DOM
            shadow.innerHTML = `
            <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet">
            <style>
                .dashboard-container {
                    max-width: 600px;
                    margin: 0;
                    padding: 20px;
                    position: relative;
                    left: -20px;
                    top: 20px;
                }
                
                .chart-container {
                    position: relative;
                    height: 220px;
                    width: 220px;
                    margin: 10px 0 20px 10px;
                }
                
                .traffic-stats {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                    margin: 20px 0 0 10px;
                }
                
                .traffic-item {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }
                
                .traffic-color {
                    width: 12px;
                    height: 12px;
                    border-radius: 3px;
                }
                
                .traffic-label {
                    font-size: 14px;
                    color: #4B5563;
                }
                
                .traffic-value {
                    font-weight: 600;
                    margin-left: auto;
                }
                
                .date-range {
                    color: #6B7280;
                    font-size: 14px;
                    margin: 0 0 10px 10px;
                }
                
                .title-container {
                    margin-left: 10px;
                }
                
                .select-container {
                    margin: 20px 0 0 10px;
                }
            </style>
            <div class="bg-white border border-gray-200 rounded-lg shadow dashboard-container">
                <!-- Título -->
                <div class="title-container">
                    <h5 class="mb-1 text-xl font-bold tracking-tight text-gray-900">Ventas del día</h5>
                    <p class="date-range">31 Nov - 31 Dec</p>
                </div>
                
                <!-- Contenedor flexible para gráfica y estadísticas -->
                <div style="display: flex; align-items: center;">
                    <!-- Gráfica de dona -->
                    <div class="chart-container">
                        <canvas id="trafficChart"></canvas>
                    </div>
                    
                    <!-- Estadísticas -->
                    <div class="traffic-stats">
                        <div class="traffic-item">
                            <div class="traffic-color" style="background-color: #3B82F6;"></div>
                            <span class="traffic-label">Chocolate</span>
                            <span class="traffic-value">52.8%</span>
                        </div>
                        <div class="traffic-item">
                            <div class="traffic-color" style="background-color: #10B981;"></div>
                            <span class="traffic-label">Fresa</span>
                            <span class="traffic-value">26.8%</span>
                        </div>
                        <div class="traffic-item">
                            <div class="traffic-color" style="background-color: #F59E0B;"></div>
                            <span class="traffic-label">Vainilla</span>
                            <span class="traffic-value">20.4%</span>
                        </div>
                    </div>
                </div>
                
                <!-- Selector de período -->
                <div class="select-container">
                    <select class="bg-gray-50 border border-gray-300 text-gray-700 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 w-40">
                        <option selected>Últimos 7 días</option>
                        <option>Últimos 30 días</option>
                        <option>Último trimestre</option>
                    </select>
                </div>
            </div>
            `;
        
            // Cargamos Chart.js dinámicamente
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
            script.onload = function() {
                // Configuración de la gráfica de dona
                const ctx = shadow.getElementById('trafficChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Chocolate', 'Fresa', 'Vainilla'],
                        datasets: [{
                            data: [52.8, 26.8, 20.4],
                            backgroundColor: [
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)'
                            ],
                            borderColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.raw + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            };
            document.head.appendChild(script);
        });
    </script>
    <script src="../../static/js/scripts.js"></script>
</body>
</html>